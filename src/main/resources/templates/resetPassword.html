<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
    <link rel="stylesheet" href="/css/fragments.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<style>
    body {
        background-image: url(/images/background.jpg);
        background-size: cover;
        background-position: left;
        background-repeat: no-repeat;
        background-attachment: fixed;
    }

    .container {
        border: none;
        height: fit-content;
        max-width: 500px;
        padding-left: 70px;
        padding-right: 110px;
        border-radius: 25px;
        padding-bottom: 20px;
        margin-top: 40px;
        padding-top: 20px;
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 15px;
        background: beige;
        opacity: 0.9;
        align-items: center;
        position: relative;
    }

    .container form {
        max-width: 500px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        margin: 10px 0 12px 0;
    }


    input[type="password"],
    input[type="text"] {
        background: none;
        display: flex;
        border: 3px solid green;
        padding: 14px 10px;
        width: 300px;
        border-radius: 15px;
        margin-top: 8px;
        margin-left: 5px;
        margin-bottom: 17px;
        outline: none;
    }

    #submit-button {
        background-color: rgb(69, 138, 69);
        color: white;
        padding: 14px 20px;
        margin-bottom: 17px;
        margin-left: 7px;
        margin-top: 11px;
        border: none;
        cursor: pointer;
        width: 200px;
        border-radius: 5px;
    }

    button[type="submit"]:hover,
    #submit-button:hover {
        background-color: green;
    }

    h3 {
        color: rgb(8, 63, 12);
        align-self: center;
        font-size: larger;
        margin-bottom: 19px;
        display: block;
    }


    label {
        margin-left: 9px;
    }

    .password-field {
        position: relative;
    }

    .password-field button {
        position: absolute;
        top: 50%;
        right: 0;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
    }

    .password-field i {
        font-size: 1.25rem;
        color: #777;
        margin-right: 10px;
        cursor: pointer;
    }

    h4{
        margin-right: 40%;
        margin-left: 40%;
    color: #198754;

    }
</style>

<body>  
    <div th:include="fragments :: navigation"></div>
    <div th:include="fragments :: deleteModal"></div>

    <h4 style="padding-top: 30px;">
        Reset your password
    </h4>

    <div class="container">

        <form th:action="@{/eagri/clients/user/resetPassword}" method="post">
            <div id="popup"
                style="display: none; border-style: solid; padding: 5px; margin: 5px; color: red; width: 300pxpx; background-color: rgba(255, 0, 0, 0.221); width: 100%; margin-bottom: 8px;">
                <p id="message" th:text="${message}"></p>
            </div>
            <div class="form-group">
                <label for="old_password">Your old password</label>
                <div class="password-field">
                    <input type="password" id="old_password" name="old_password"
                        placeholder="&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;">
                    <button id="toggle-password" type="button" aria-label="Toggle password visibility">
                        <span class="visually-hidden">Toggle password visibility</span>
                        <i class="fa fa-eye"></i>
                    </button> 
                </div>
            </div>
            <div class="form-group">
                <label for="new_password">Your new password</label>
                <div class="password-field">
                    <input type="password" id="new_password" name="new_password" th:value="${new_password}"
                        placeholder="&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;">
                    <button id="toggle-password2" type="button" aria-label="Toggle password visibility">
                        <span class="visually-hidden">Toggle password visibility</span>
                        <i class="fa fa-eye"></i>
                    </button>
                </div>
            </div>
            <div class="form-group">
                <label for="password_confirm">Confirm your new password</label>
                <div class="password-field">
                    <input type="password" id="password_confirm" name="password_confirm"
                        placeholder="&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;&#9679;">
                    <button id="toggle-password3" type="button" aria-label="Toggle password visibility">
                        <span class="visually-hidden">Toggle password visibility</span>
                        <i class="fa fa-eye"></i>
                    </button>
                </div>
            </div>

            <button id="submit-button" type="submit" onclick="submit()">Reset </button><br>
        </form>
    </div>

    <div>
        <p hidden th:text="${#authentication.principal.getUser().getPassword()}" id="userPass"></p>
    </div>
</body>
<script>

    $(document).ready(function () {
      $('a[data-toggle="modal"]').click(function (e) {
        e.preventDefault();
        var target = $(this).attr('href');
        $(target).modal('show');
      });
    });

    var message = document.getElementById("message").textContent;
    if (message) {
        document.getElementById("popup").style.display = "block";
    }

    const passwordField = document.querySelector('.password-field');
    const togglePasswordBtn = document.querySelector('#toggle-password');

    const old_password = document.querySelector('#old_password');
    togglePasswordBtn.addEventListener('click', function () {
        const type = old_password.getAttribute('type') === 'password' ? 'text' : 'password';
        old_password.setAttribute('type', type);
        togglePasswordBtn.querySelector('i').classList.toggle('fa-eye-slash');
    });

    const togglePasswordBtn2 = document.querySelector('#toggle-password2');
    const new_password = document.querySelector("#new_password");
    togglePasswordBtn2.addEventListener('click', function () {
        const type = new_password.getAttribute('type') === 'password' ? 'text' : 'password';
        new_password.setAttribute('type', type);
        togglePasswordBtn2.querySelector('i').classList.toggle('fa-eye-slash');
    });

    const togglePasswordBtn3 = document.querySelector('#toggle-password3');
    const password_confirm = document.querySelector("#password_confirm");
    togglePasswordBtn3.addEventListener('click', function () {
        const type = password_confirm.getAttribute('type') === 'password' ? 'text' : 'password';
        password_confirm.setAttribute('type', type);
        togglePasswordBtn3.querySelector('i').classList.toggle('fa-eye-slash');
    });

    function submit() {
        if (oldPass !== entered_oldPass) {
            entered_oldPass.setCutsomValidity('Incorrect old password');
        } else {
            //test if the new passwords are matching
            document.getElementById('password_confirm').setCustomValidity('');

            var new_password = document.getElementById('new_password');
            var new_passwordConfirm = document.getElementById('password_confirm');
            var url = window.location.protocol + '//' + window.location.host;

            if ((new_password.value !== new_passwordConfirm.value)) {
                document.getElementById('password_confirm').setCustomValidity('Passwords do not match');
                passwordMatch();
            } else {
                document.getElementById('password_confirm').setCustomValidity('');
                // window.alert("Resgistration Successful ! Click Ok to go to your homepage");
            }
        }
    }
</script>

</html>